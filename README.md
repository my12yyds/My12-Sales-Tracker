## 微信小程序：主播-销售分组式线索跟进系统（云开发）

### 核心特性
- ✅ **多销售协作**：一条线索可分配给多个销售，支持协作跟进
- ✅ **小组隔离**：4个小组数据完全隔离
- ✅ **角色权限**：主播/销售/管理员三角色权限分离
- ✅ **实时统计**：管理员看板实时统计各小组数据

### 运行方式（开发者工具）
1. 用微信开发者工具导入本项目根目录
2. 开启「云开发」，选择或新建环境
3. 在「云函数」面板上传并部署 `cloudfunctions/` 下所有云函数（首次部署需要安装依赖）
4. 数据库会自动创建集合（首次调用云函数时）

### 目录结构
```
miniprogram/          小程序端
  ├── pages/          页面
  │   ├── anchor/     主播端页面
  │   ├── sales/      销售端页面
  │   ├── admin/      管理员端页面
  │   └── ...
  └── utils/          工具函数
cloudfunctions/       云函数（后端）
  ├── authLogin       登录/用户初始化
  ├── leadCreate      创建线索（主播）
  ├── leadList        获取线索列表
  ├── leadAssignSales 分配销售（支持多销售）
  ├── followUpCreate  创建跟进记录（销售）
  ├── followUpList    获取跟进记录列表
  └── adminDashboard  管理员数据看板
docs/                 需求/设计文档
```

### 角色定义（数字枚举）
- `role = 0`：管理员（仅查看全量数据与看板，无写权限）
- `role = 1`：主播（录入本组线索、查看本组线索、分配销售）
- `role = 2`：销售（查看分配给自己的线索、填写跟进记录）

### 小组隔离与多销售协作
- **小组隔离**：`groupId` 1~4（固定 4 组）
  - 主播只能访问自己 `groupId` 下的线索
  - 销售只能访问自己 `groupId` 且 `assignedSalesIds` 包含自己的线索
  - 管理员可查看全量，但不允许录入/跟进写操作

- **多销售协作**：
  - 线索表 `leads` 包含 `assignedSalesIds` 数组字段
  - 主播录入线索时可选择多个销售（不选则自动分配最少负载的销售）
  - 主播可以后续添加/移除销售（通过 `leadAssignSales` 云函数）
  - 多个销售可以同时对同一条线索添加跟进记录

### 数据库集合
- `users`：用户表（role: 0管理员/1主播/2销售，groupId: 1~4）
- `leads`：线索表（groupId, assignedSalesIds数组，状态字段等）
- `followUps`：跟进记录表（leadId, salesId, 跟进时间/状态/备注等）

### 快速开始
1. **初始化用户**：首次登录会自动创建用户（默认 role=2 销售，groupId=1）
2. **设置角色**：在数据库 `users` 表中手动修改用户的 `role` 和 `groupId`
   - 管理员：`role = 0`，`groupId` 可为 0 或空
   - 主播：`role = 1`，`groupId = 1~4`
   - 销售：`role = 2`，`groupId = 1~4`
3. **开始使用**：
   - 主播：录入线索 → 查看本组线索
   - 销售：查看我的线索 → 添加跟进记录
   - 管理员：查看数据看板

### 注意事项
- 所有权限校验在云函数中实现，前端隐藏仅作体验优化
- 销售ID必须在云函数中强制设置，不接受前端传入
- 小组隔离通过 `groupId` 字段在云函数查询条件中强制实现

