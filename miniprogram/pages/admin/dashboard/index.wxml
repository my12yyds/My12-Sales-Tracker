<!--ç®¡ç†å‘˜-æ•°æ®çœ‹æ¿é¡µ-->
<view class="container">
  <view class="card">
    <view class="header-top">
      <view>
        <text class="title">æ•°æ®çœ‹æ¿</text>
    <view class="muted small" wx:if="{{userName}}" style="margin-top: 8rpx;">
      å½“å‰è´¦å·ï¼š{{userName}}
    </view>
    <view class="muted small" style="margin-top: 4rpx;">
      è§’è‰²ï¼šç®¡ç†å‘˜
    </view>
      </view>
      <button class="btn-refresh" size="mini" bindtap="onRefresh" loading="{{loading}}">
        <text wx:if="{{!loading}}">åˆ·æ–°</text>
        <text wx:else>åˆ·æ–°ä¸­...</text>
      </button>
    </view>
    
    <view class="admin-actions">
      <button class="btn-action btn-primary" bindtap="goUsers">
        <text class="btn-icon">ğŸ‘¥</text>
        <text class="btn-text">ç”¨æˆ·ç®¡ç†</text>
        <text class="btn-desc">è§’è‰²/å°ç»„è®¾ç½®</text>
      </button>
      <button class="btn-action btn-primary" bindtap="goProfile">
        <text class="btn-icon">ğŸ‘¤</text>
        <text class="btn-text">ä¸ªäººä¸­å¿ƒ</text>
        <text class="btn-desc">è´¦å·ä¿¡æ¯</text>
      </button>
    </view>
  </view>

  <view class="card summary-card" wx:if="{{summary}}">
    <text class="card-title">æ€»ä½“ç»Ÿè®¡</text>
    <view class="summary-row">
      <view class="summary-item">
        <text class="value">{{summary.totalLeads}}</text>
        <text class="label">æ€»çº¿ç´¢æ•°</text>
      </view>
      <view class="summary-item">
        <text class="value">{{summary.totalFollowUpRate}}%</text>
        <text class="label">å·²è·Ÿè¿›ç‡</text>
      </view>
    </view>
  </view>

  <view class="group-stats" wx:if="{{groupStats.length > 0}}">
    <text class="section-title">å„å°ç»„ç»Ÿè®¡</text>
    <view class="card group-card" wx:for="{{groupStats}}" wx:key="groupId">
      <view class="group-header">
        <text class="group-name">ç¬¬{{item.groupId}}ç»„</text>
        <text class="group-members">{{item.anchors}}ä¸»æ’­ + {{item.sales}}é”€å”®</text>
      </view>
      <view class="group-summary">
        <view class="stat-item">
          <text class="stat-value">{{item.totalLeads}}</text>
          <text class="stat-label">çº¿ç´¢æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{item.followUpRate}}%</text>
          <text class="stat-label">å·²è·Ÿè¿›ç‡</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{item.followedLeads}}</text>
          <text class="stat-label">å·²è·Ÿè¿›</text>
        </view>
      </view>
      <view class="status-distribution">
        <text class="dist-label">çŠ¶æ€åˆ†å¸ƒï¼š</text>
        <text class="dist-item">æœªè”ç³» {{item.statusStats.NEW}}</text>
        <text class="dist-item">å·²è”ç³» {{item.statusStats.CONTACTED}}</text>
        <text class="dist-item">å·²æŠ¥ä»· {{item.statusStats.QUOTED}}</text>
        <text class="dist-item">æˆäº¤ {{item.statusStats.WON}}</text>
        <text class="dist-item">æµå¤± {{item.statusStats.LOST}}</text>
      </view>

      <view class="group-leads">
        <view class="row-between" style="margin-bottom: 16rpx;">
          <text class="leads-title">çº¿ç´¢åˆ—è¡¨ï¼ˆæ˜¾ç¤ºæœ€è¿‘3æ¡ï¼‰</text>
          <button class="btn-primary" size="mini" bindtap="goGroupLeads" data-group="{{item.groupId}}">æŸ¥çœ‹å…¨éƒ¨</button>
        </view>
        <view class="lead-row-wrapper" wx:for="{{item.leads}}" wx:for-item="leadItem" wx:key="_id">
          <view class="lead-row" data-id="{{leadItem._id}}" bindtap="goLeadDetail">
            <view class="lead-main">
              <text class="lead-phone">{{leadItem.phone}}</text>
              <text class="lead-status tag-status tag-{{leadItem.lastStatus}}">{{leadItem.lastStatusText}}</text>
            </view>
            <view class="lead-meta">
              <text class="meta-text">åˆ†é…ï¼š{{leadItem.assignedSalesNames || 'æœªåˆ†é…'}}</text>
              <text class="meta-text" style="margin-left: 12rpx;">è·Ÿè¿›ï¼š{{leadItem.followUpCount || 0}}æ¬¡</text>
            </view>
            <view class="lead-meta">
              <text class="meta-text">ä¸»æ’­ï¼š{{leadItem.createdBy}}</text>
              <text class="meta-text" style="margin-left: 12rpx;">åˆ›å»ºï¼š{{leadItem.createdAtDate || 'â€”'}}</text>
            </view>
            <view class="lead-meta">
              <text class="meta-text">æœ€è¿‘ï¼š{{leadItem.lastFollowUpDate || 'â€”'}}</text>
            </view>
          </view>
          <button class="btn-danger-mini" size="mini" data-id="{{leadItem._id}}" bindtap="onDeleteLead">åˆ é™¤</button>
        </view>
        <view class="empty" wx:if="{{item.leads.length === 0}}">
          <text>æš‚æ— çº¿ç´¢</text>
        </view>
      </view>
    </view>
  </view>

  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>

<view class="watermark">my12yyds</view>
